"
Assignment 8

Create a Library database with the schema Books(AccNo,Title,Author,Publisher,Count).
Create a table Library_Audit with same fiels as of Books.
Create a before trigger to insert records into Librry_Audit table if there is deletion in Books table.
Create a after trigger to insert records into Librry_Audit table if there is updation in Books table.
"


CREATE TABLE LIBRARY(BOOK_ID INT,BOOK_TITLE VARCHAR(30),BOOK_COUNT INT,PRIMARY KEY(BOOK_ID));
CREATE TABLE LIBRARY_AUDIT(BOOK_ID INT,BOOK_TITLE VARCHAR(30), BOOK_COUNT INT,ACTION VARCHAR(30),ACTION_DATE DATE);

INSERT INTO LIBRARY VALUES(1,'THE CHRONICLES OF NARINA',5);
INSERT INTO LIBRARY VALUES(2,'ATOMIC HABITS',6);
INSERT INTO LIBRARY VALUES(3,'ALCHEMIST',3);
INSERT INTO LIBRARY VALUES(4,'THE POWER OF HABIT',2);
INSERT INTO LIBRARY VALUES(5,'HARRY POTTER SERIES',1);
INSERT INTO LIBRARY VALUES(6,'IKIGAI',4);

SELECT * FROM LIBRARY;

CREATE OR REPLACE TRIGGER BOOKS_UPDATE_DELETE_TRIGGER
    BEFORE UPDATE OR DELETE ON LIBRARY
    FOR EACH ROW
    
    DECLARE 
       CHANGE_ACTION VARCHAR(30);
    
    BEGIN
       IF UPDATING THEN
          CHANGE_ACTION:='UPDATE';
       ELSIF DELETING THEN
          CHANGE_ACTION:='DELETE';
       END IF;

       INSERT INTO LIBRARY_AUDIT (BOOK_ID,BOOK_TITLE,BOOK_COUNT,ACTION,ACTION_DATE)VALUES(:OLD.BOOK_ID,:OLD.BOOK_TITLE,:OLD.BOOK_COUNT,CHANGE_ACTION,SYSDATE);

    EXCEPTION
       WHEN OTHERS THEN
          DBMS_OUTPUT.PUT_LINE('ERROR OCCURED');
END;

UPDATE LIBRARY SET BOOK_TITLE='SITA : WARRIOR PRINCESS' WHERE BOOK_ID=1;
DELETE FROM LIBRARY WHERE BOOK_ID=5;
    
SELECT * FROM LIBRARY;
SELECT * FROM LIBRARY_AUDIT;
